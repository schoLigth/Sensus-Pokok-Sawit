<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Peta Kunjungan</title>

    <!-- Bootstrap -->
    <link 
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" 
        rel="stylesheet"
    >

    <!-- Leaflet CSS -->
    <link 
        rel="stylesheet" 
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />

    <style>
        #map {
            height: 500px;
            border-radius: 12px;
        }
    </style>
</head>

<body class="bg-light">

<div class="container mt-4">

    <h3 class="fw-bold mb-3">Peta Lokasi Kunjungan</h3>
    <p class="text-muted">Lokasi kamu akan ditampilkan pada peta secara otomatis.</p>

    <!-- MAP -->
    <div id="map"></div>

    <!-- Informasi lokasi -->
    <div class="mt-3 p-3 bg-white shadow-sm rounded">
        <h5 class="fw-semibold">Lokasi Saat Ini</h5>
        <p id="lokasiText" class="mb-0 text-muted">Mengambil lokasi...</p>
    </div>

    <!-- Tombol kembali -->
    <br>
    <div class="mb-3">
        <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">‚Üê Kembali</a>
    </div>

</div>

<!-- Leaflet JS -->
<script 
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js">
</script>

<script>
// ============================
// 1. Inisialisasi Map
// ============================
var map = L.map('map').setView([0, 0], 15);

// Layer OpenStreetMap
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19
}).addTo(map);

let userMarker;


// ============================
// 2. Ambil Lokasi User
// ============================
function getUserLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition, showError);
    } else {
        document.getElementById("lokasiText").innerText = "Browser tidak mendukung GPS.";
    }
}

function showPosition(position) {
    let lat = position.coords.latitude;
    let lon = position.coords.longitude;

    // Tampilkan di map
    map.setView([lat, lon], 17);

    // Tambahkan marker
    userMarker = L.marker([lat, lon]).addTo(map);
    userMarker.bindPopup("Lokasi Anda").openPopup();

    // Tampilkan teks GPS
    document.getElementById("lokasiText").innerText =
        `Lat: ${lat.toFixed(6)}, Lon: ${lon.toFixed(6)}`;
}

function showError(error) {
    document.getElementById("lokasiText").innerText = "Gagal mengambil lokasi.";
}

// Jalankan saat halaman dibuka
getUserLocation();
</script>

</body>
</html>
